caption: {{$:/core/images/advanced-search-button}} {{$:/plugins/bimlas/locator/language/buttons/search-in-context}}
description: {{$:/plugins/bimlas/locator/language/buttons/search-in-context}}
tags: $:/tags/bimlas/locator/view-toolbar
title: $:/plugins/bimlas/locator/buttons/search-in-context
type: text/vnd.tiddlywiki

\define actions()
  <$list filter="[[intersection]] [[difference]]" variable="state">
    <$macrocall
      $name="copy-state"
      sourceMacro="view"
      sourceTitle=<<currentTiddler>>
      destinationMacro="search"
      destinationTitle=""
      state=<<state>>
    />
  </$list>
  <$action-listops $tiddler="$:/state/bimlas/locator/search/intersection/" $index={{{ [subfilter<filter-field-of-relationship>] }}} $subfilter="[subfilter<filter-history>last[]]"/>
  <$macrocall $name="clear-data-tiddler" tiddler="$:/state/bimlas/locator/search/recursive-filters/"/>
  <$action-listops $tiddler="$:/state/bimlas/locator/search/recursive-filters/" $index={{{ [subfilter<filter-field-of-relationship>] }}} $filter="[subfilter<filter-history>last[]]"/>
  <$action-sendmessage message $message="tm-notify" $param="$:/plugins/bimlas/locator/language/search-in-context"/>
\end

<$list filter="[title<contextState>!field:invert-direction[yes]]" variable="null">
  <$macrocall
    $name="toolbar-button"
    icon={{$:/core/images/advanced-search-button}}
    tooltip={{$:/plugins/bimlas/locator/language/buttons/search-in-context}}
    actions=<<actions>>
  />
</$list>