tags: $:/tags/Macro
title: $:/plugins/bimlas/locator/macros/locator-view
type: text/vnd.tiddlywiki

\define locator-view(baseTitle fieldOfRelationship:"tags")
  <!-- Hide internal macros, do not make them globally available -->
  <$importvariables filter="[all[tiddlers+shadows]prefix[$:/plugins/bimlas/locator/macros/]]">
    <$vars
      contextState="$:/state/bimlas/locator/view/context/$(currentTiddler)$"
      intersectionState="$:/state/bimlas/locator/view/intersection/$(currentTiddler)$"
      differenceState="$:/state/bimlas/locator/view/difference/$(currentTiddler)$"
      defaultFieldOfRelationship=<<__fieldOfRelationship__>>
    >
      <!-- I have to create them nested because internal variables use external ones -->
      <$vars currentField={{{ [subfilter<filter-field-of-relationship>] }}}>
        <$vars filterContextItems=<<filter-view-context>>>
          <div class="tc-table-of-contents">

            {{$:/plugins/bimlas/locator/templates/history}}

            ---

            <div class="bimlas-locator right">
              {{||$:/plugins/bimlas/locator/buttons/create-new-tiddler}}
              {{$:/plugins/bimlas/locator/buttons/search-in-context}}
              {{$:/plugins/bimlas/locator/buttons/collapse-history}}
              {{$:/plugins/bimlas/locator/buttons/toggle-relationship-settings}}
            </div>
            {{$:/plugins/bimlas/locator/templates/relationship-settings}}
            {{$:/plugins/bimlas/locator/templates/fields-filter}}
            <ol class="bimlas-locator">
              <$list filter=<<filterContextItems>>>
                <$macrocall
                  $name="droppable-menu-list-item"
                  content={{$:/plugins/bimlas/locator/templates/context-item}}
                  actions={{$:/plugins/bimlas/locator/actions/move-to-another-context}}
                />
            </$list>
            </ol>

          </div>
        </$vars>
      </$vars>
    </$vars>
  </$importvariables>
\end
